<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type - Bold Web Connections</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #141414;
        }

        .ui-controls {
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            height: 100vh;
            background-color: white;
            padding: 30px;
            box-sizing: border-box;
            color: black;
            z-index: 10;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
            font-size: 1.5rem;
        }

        .ui-controls a {
            color: black;
            text-decoration: none;
            display: block;
            margin-bottom: 30px;
            font-weight: normal;
            transition: 0.3s;
        }

        .ui-controls a:hover {
            color: var(--main-color);
            padding-left: 10px;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 250px;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            font-size: 1rem;
            margin-bottom: 15px;
            border: 1px solid #ccc;
        }

        .ui-controls input:focus {
            outline: none;
        }

        .label-ui {
            margin: 30px 0 8px 0;
            display: block;
        }

        .label-ui:first-of-type {
            margin-top: 0;
        }

        .color-code {
            position: absolute;
            bottom: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.4);
            font-family: monospace;
            font-size: 1.2rem;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="ui-container" class="ui-controls">
        <a href="../../index.html">← Go back</a>
    </div>
    <div id="color-code" class="color-code"></div>

    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.1/lib/p5.min.js"></script>
    <script>
        let mainColor;
        let textInput;
        let letters = [];
        let fontSize = 110;
        
        let webOpacity = 0;
        let lastMoveTime = 0;
        const idleDelay = 1000; 

        let magnetSlider, sensitivitySlider, turbulenceSlider, connectionSlider;

        function getRandomColor() {
            const lettersHex = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) color += lettersHex[Math.floor(Math.random() * 16)];
            return color;
        }

        function setup() {
            createCanvas(windowWidth - 250, windowHeight);
            
            const randomColorHex = getRandomColor();
            document.documentElement.style.setProperty('--main-color', randomColorHex);
            mainColor = color(randomColorHex);
            select('#color-code').html(randomColorHex);

            const uiContainer = select('#ui-container');

            createSpan('TESTO').addClass('label-ui').parent(uiContainer);
            textInput = createInput('TEXT');
            textInput.parent(uiContainer).input(createLetters);

            createSpan('RETURN SPEED').addClass('label-ui').parent(uiContainer);
            magnetSlider = createSlider(1, 20, 8);
            magnetSlider.parent(uiContainer).style('width', '180px').style('accent-color', randomColorHex);

            createSpan('MOUSE RADIUS').addClass('label-ui').parent(uiContainer);
            sensitivitySlider = createSlider(50, 400, 180);
            sensitivitySlider.parent(uiContainer).style('width', '180px').style('accent-color', randomColorHex);

            createSpan('WEB DISTANCE').addClass('label-ui').parent(uiContainer);
            connectionSlider = createSlider(50, 400, 250);
            connectionSlider.parent(uiContainer).style('width', '180px').style('accent-color', randomColorHex);

            createSpan('TURBULENCE').addClass('label-ui').parent(uiContainer);
            turbulenceSlider = createSlider(0, 100, 20);
            turbulenceSlider.parent(uiContainer).style('width', '180px').style('accent-color', randomColorHex);

            textAlign(CENTER, CENTER);
            textFont('Helvetica');
            textStyle(BOLD);
            textSize(fontSize);

            createLetters();
        }

        function createLetters() {
            letters = [];
            let str = textInput.value().toUpperCase();
            let totalWidth = textWidth(str);
            let startX = (width / 2) - (totalWidth / 2);

            for (let i = 0; i < str.length; i++) {
                let char = str[i];
                let x = startX + textWidth(str.substring(0, i)) + textWidth(char) / 2;
                let y = height / 2;
                letters.push({
                    char: char, homeX: x, homeY: y,
                    currX: x, currY: y, velX: 0, velY: 0,
                    angle: 0
                });
            }
        }

        function draw() {
            background(mainColor);

            let magnetForce = magnetSlider.value() / 100;
            let repulsionDist = sensitivitySlider.value();
            let turbAmount = turbulenceSlider.value() / 500;
            let webDist = connectionSlider.value();

            let totalMotion = 0;
            let mouseNear = false;
            for (let l of letters) {
                totalMotion += dist(0, 0, l.velX, l.velY);
                totalMotion += dist(l.currX, l.currY, l.homeX, l.homeY);
                if (dist(mouseX, mouseY, l.currX, l.currY) < repulsionDist) mouseNear = true;
            }

            if (totalMotion > 0.5 || mouseNear) {
                lastMoveTime = millis();
                webOpacity = lerp(webOpacity, 1, 0.15); 
            } else {
                if (millis() - lastMoveTime > idleDelay) {
                    webOpacity = lerp(webOpacity, 0, 0.05); 
                }
            }

            // 1. DISEGNO CONNESSIONI (SPESSORE E OPACITÀ AUMENTATI)
            if (webOpacity > 0.01) {
                for (let i = 0; i < letters.length; i++) {
                    for (let j = i + 1; j < letters.length; j++) {
                        let d = dist(letters[i].currX, letters[i].currY, letters[j].currX, letters[j].currY);
                        if (d < webDist) {
                            // Opacità quasi piena (255) quando vicini, cala verso webDist
                            let baseAlpha = map(d, 0, webDist, 255, 20); 
                            stroke(255, baseAlpha * webOpacity); 
                            strokeWeight(5); // Spessore molto più evidente
                            line(letters[i].currX, letters[i].currY, letters[j].currX, letters[j].currY);
                        }
                    }
                }
            }

            // 2. AGGIORNAMENTO E DISEGNO LETTERE
            for (let l of letters) {
                let d = dist(mouseX, mouseY, l.currX, l.currY);

                if (d < repulsionDist) {
                    let angle = atan2(l.currY - mouseY, l.currX - mouseX);
                    let force = map(d, 0, repulsionDist, 15, 0);
                    l.velX += cos(angle) * force;
                    l.velY += sin(angle) * force;
                } else {
                    l.currX = lerp(l.currX, l.homeX, magnetForce);
                    l.currY = lerp(l.currY, l.homeY, magnetForce);
                    l.angle = lerp(l.angle, 0, magnetForce);
                }

                l.currX += l.velX;
                l.currY += l.velY;
                l.velX *= 0.92;
                l.velY *= 0.92;

                let speed = dist(0, 0, l.velX, l.velY);
                l.angle += speed * turbAmount;

                if (l.currX < -50) l.currX = width + 50;
                if (l.currX > width + 50) l.currX = -50;
                if (l.currY < -50) l.currY = height + 50;
                if (l.currY > height + 50) l.currY = -50;

                push();
                translate(l.currX, l.currY);
                rotate(l.angle);
                fill(255);
                noStroke();
                text(l.char, 0, 0);
                pop();
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth - 250, windowHeight);
            createLetters();
        }
    </script>
</body>
</html>